<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service for get text from image</title>
    <style type="text/css">
     @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            outline: none;
            text-decoration: none;
            list-style: none;
        }
        html, body {
            font-family: 'Roboto', sans-serif;
        }
        #app {
            height: 100vh;
        }
        .container {
            position: relative;
            max-width: 90vw;
            display: flex;
            flex-direction: column;
            height: 100%;
            align-items: center;
            margin: 0 auto;
        }
        .dragging {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #828282;
            background: #ebebf3;
            font-size: 2rem;
            z-index: 1000;
        }
        .container-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .title {
            font-size: 1.5rem;
            line-height: 1.5rem;
            color: black;
            font-weight: 400;
            text-align: left;
        }
        .img-paste {
            height: 100%;
            object-fit: contain;
            user-select: none;
            width: 100%;
            pointer-events: none;
            opacity: 0.8;
        }
        .subtitle {
            margin-top: 1.5rem;
            font-size: 1.2rem;
            line-height: 1.2rem;
            color: black;
            font-weight: 400;
            text-align: left;
        }
        .content {
            margin: 4.56rem 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            position: relative;
        }
        .upload-description {
            font-size: 1.5rem;
            color: black;
            font-weight: 400;
        }
        .upload-subtitle {
            margin-top: 0.875rem;
        }
        .bold-underline[class] {
            font-weight: 700;
            text-decoration: underline;
        }
        .img-with-texts {
            position: absolute;
            top: 0;
            left: 0;
        }
        .upload-wrapper {
            margin-top: 5.87rem;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 2.75rem;
            max-width: 428px;
            width: 100%;
            height: 203px;
            background: #EFEFEF;
            border-radius: 0.625rem;
        }
        .status-message {
            margin: 0 auto;
            margin-top: 2rem;
            font-size: 1.5rem;
            color: green;
            font-weight: 400;
        }
        .upload-description {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .upload-img {
            margin-right: 2.25rem;
        }
        .img-with-text-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .img-with-text-footer .footer-social-share .social-button:last-child > svg{
            margin-right: 0px;
        }
        .img-with-text-footer .footer-item.footer-social-share {
            opacity: 1;
        }
        .img-with-text-footer .footer-item.copy svg {
            margin-right: 0px;
            margin-left: 0.813rem;
        }
        .img-with-text-footer .footer-item.footer-social-share svg {
            fill: none;
            opacity: 0.5;
            transition: 0.3s;
        }
        .img-with-text-footer .footer-item.footer-social-share svg:hover {
            opacity: 1;
            fill: black;
        }
        .img-with-text-footer .footer-item {
            opacity: 0.5;
            transition: 0.3s;
        }
        .img-with-text-footer .footer-item:hover {
            opacity: 1;
        }
        .img-with-text-footer .footer-item {
            margin-right: 2rem;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            cursor: pointer;
        }
        .img-with-text-footer .footer-item:last-child {
            margin-right: 0px;
        }
        .img-with-text-footer .footer-item svg {
            margin-right: 1.5rem;
        }
        .hide {
            display: none !important;
        }
        .loader-texts[class] {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .lds-ring {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 80px;
            z-index: 1000;
        }
        .lds-ring div {
            box-sizing: border-box;
            display: block;
            position: absolute;
            width: 64px;
            height: 64px;
            margin: 8px;
            border: 8px solid black;
            border-radius: 50%;
            animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            border-color: black transparent transparent transparent;
        }
        .lds-ring div:nth-child(1) {
            animation-delay: -0.45s;
        }
        .lds-ring div:nth-child(2) {
            animation-delay: -0.3s;
        }
        .lds-ring div:nth-child(3) {
            animation-delay: -0.15s;
        }
        @keyframes lds-ring {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <main id="app">
        <div class="container">
            <div class="dragging hide">Drop files here"</div>
            <div class="content">
                <img src="" class="img img-paste hide" />
                <div class="img-with-texts hide"></div>
                <div class="container-header hide">
                    <h1 class="title">Copy text from image</h1>
                    <h2 class="subtitle">Transform image to text by Ctrl+V and copy text in one click</h2>
                </div>

                <div class="upload-wrapper hide">
                    <div class="upload-img">
                        <svg width="96" height="96" viewBox="0 0 96 96" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <g opacity="0.3">
                            <path d="M12 12V18H18V12H12ZM24 12V18H30V12H24ZM36 12V18H42V12H36ZM48 12V18H54V12H48ZM60 12V18H66V12H60ZM72 12V18H78V12H72ZM12 24V30H18V24H12ZM72 24V30H78V24H72ZM12 36V42H18V36H12ZM72 36V42H78V36H72ZM43.5 39L42.5625 40.2188L39 45H27H24V48V81V84H27H81H84V81V48V45H81H69L65.4375 40.2188L64.5 39H63H45H43.5ZM46.5 45H61.5L65.0625 49.7812L66 51H67.5H78V78H30V51H40.5H42L42.9375 49.7812L46.5 45ZM12 48V54H18V48H12ZM54 51C47.4081 51 42 56.4081 42 63C42 69.5919 47.4081 75 54 75C60.5919 75 66 69.5919 66 63C66 56.4081 60.5919 51 54 51ZM54 57C57.3492 57 60 59.6508 60 63C60 66.3492 57.3492 69 54 69C50.6508 69 48 66.3492 48 63C48 59.6508 50.6508 57 54 57ZM12 60V66H18V60H12Z" fill="black"/>
                            </g>
                        </svg>
                    </div>
                    <div class="upload-description">
                        <div class="upload-title">Ctrl+V screenshot</div>
                        <div class="upload-subtitle">or <span class="bold-underline">UPLOAD FILE</span></div>
                    </div>
                </div>
                <div class="img-with-text-footer hide">
                    <div class="footer-item bold-underline" onclick="onResetClick()">NEW IMAGE</div>
                    <div class="footer-item footer-social-share">
                        <div class="social-button" onclick="window.open('https:\/\/www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(`${window.app.getTexts()}`) + '&t=' + encodeURIComponent(`${window.app.getTexts()}`));">
                            <svg width="9" height="17" viewBox="0 0 9 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.84172 16.9999V9.2454H8.4952L8.89246 6.22333H5.84172V4.29384C5.84172 3.4189 6.08944 2.82258 7.3686 2.82258L9 2.82184V0.118952C8.71772 0.0822564 7.74938 0 6.62278 0C4.27066 0 2.66034 1.40829 2.66034 3.99469V6.22342H0V9.24548H2.66026V17L5.84172 16.9999Z" fill="#969696"/>
                            </svg>
                        </div>
                        <div class="social-button" onclick="window.open('https://wa.me/?text=' + ' %20 ' + encodeURIComponent(`${window.app.getTexts()}`)); return false;">
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.3783 2.61715C14.5484 1.78459 13.5606 1.1245 12.4722 0.675229C11.3839 0.225954 10.2167 -0.00355241 9.03856 4.15654e-05C4.09669 4.15654e-05 0.0762634 4.00162 0.0762634 8.91785C0.0714726 10.4835 0.483855 12.0224 1.27136 13.3776L0 18L4.75166 16.7584C6.06598 17.4709 7.53842 17.8449 9.03497 17.8464H9.03856C13.9768 17.8464 17.9964 13.8448 18 8.92499C18.0037 7.75321 17.774 6.59233 17.3239 5.50958C16.8739 4.42682 16.2126 3.4437 15.3783 2.61715ZM13.4224 12.1075C13.2366 12.6273 12.3224 13.1293 11.9123 13.1642C11.4987 13.2026 11.1138 13.3491 9.22428 12.6104C6.94535 11.7172 5.50981 9.39303 5.39676 9.24297C5.2846 9.09649 4.48518 8.03535 4.48518 6.94028C4.48518 5.84163 5.06389 5.30392 5.26756 5.08062C5.47392 4.85732 5.71617 4.80104 5.8669 4.80104C6.01404 4.80104 6.16477 4.80104 6.29397 4.80819C6.45547 4.81176 6.63043 4.82159 6.79911 5.19227C6.99829 5.63173 7.43344 6.73395 7.48996 6.8456C7.54559 6.95725 7.58417 7.09034 7.50701 7.23683C7.43344 7.38688 7.39486 7.47799 7.28629 7.61019C7.17414 7.73881 7.05122 7.89959 6.94984 7.99695C6.83769 8.1086 6.72195 8.23097 6.85114 8.45427C6.98124 8.67757 7.42985 9.40643 8.09558 9.99595C8.95063 10.757 9.67289 10.991 9.89719 11.1026C10.1215 11.2143 10.2507 11.1964 10.3808 11.0464C10.5136 10.8999 10.9416 10.3979 11.0923 10.1746C11.2394 9.95129 11.3902 9.9897 11.5929 10.0629C11.7993 10.1362 12.9002 10.6766 13.1245 10.7882C13.3488 10.8999 13.4959 10.9562 13.5525 11.0473C13.6081 11.141 13.6081 11.5876 13.4224 12.1075Z" fill="#969696"/>
                            </svg>
                        </div>
                        <div class="social-button" onclick="window.open('https:\/\/twitter.com/intent/tweet?text=' + ' %20 ' + encodeURIComponent(`${window.app.getTexts()}`)); return false;">
                            <svg width="24" height="19" viewBox="0 0 24 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M23.298 2.24134C22.4408 2.6215 21.5196 2.87844 20.5527 2.994C21.5396 2.40241 22.2974 1.46568 22.6543 0.349568C21.7308 0.89727 20.7079 1.29507 19.6191 1.50948C18.7471 0.580511 17.5049 0 16.1301 0C13.4903 0 11.3501 2.1401 11.3501 4.77976C11.3501 5.15438 11.3925 5.5192 11.474 5.86903C7.50139 5.6697 3.97938 3.76676 1.62189 0.874942C1.21045 1.5809 0.974734 2.40198 0.974734 3.27795C0.974734 4.93622 1.81866 6.39926 3.1012 7.25639C2.31761 7.23159 1.58064 7.01658 0.93613 6.65858C0.935789 6.67852 0.935789 6.69855 0.935789 6.71866C0.935789 9.03457 2.58341 10.9665 4.77004 11.4055C4.36892 11.5148 3.94666 11.5732 3.51068 11.5732C3.2027 11.5732 2.90324 11.5432 2.61145 11.4874C3.21966 13.3864 4.98488 14.7684 7.07649 14.807C5.44063 16.0889 3.37961 16.8531 1.14023 16.8531C0.754443 16.8531 0.373941 16.8305 0 16.7863C2.1153 18.1425 4.62781 18.9338 7.32712 18.9338C16.119 18.9338 20.9267 11.6504 20.9267 5.33402C20.9267 5.12677 20.9221 4.92062 20.9129 4.71567C21.8467 4.04176 22.6572 3.19988 23.298 2.24134Z" fill="#969696"/>
                            </svg>
                        </div>
                        <div class="social-button" onclick="window.open('https:\/\/reddit.com/submit/?url=' + encodeURIComponent(`${window.app.getTexts()}`)); + '&amp'; return false;">
                            <svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 9.01668C21 7.63123 19.8214 6.50407 18.3726 6.50407C17.5643 6.50407 16.8207 6.84952 16.3249 7.44192C14.9337 6.83667 13.3475 6.46373 11.6696 6.34563L13.1113 1.98862L16.3313 2.65583C16.5779 3.57343 17.4499 4.25371 18.4852 4.25371C19.7115 4.25371 20.7093 3.29963 20.7093 2.12689C20.7093 0.954146 19.7115 0 18.4852 0C17.5994 0 16.8338 0.498287 16.4765 1.21682L12.7609 0.446886C12.3825 0.368492 12.0032 0.578475 11.8863 0.931891L10.1068 6.30938C8.14273 6.35518 6.27925 6.74392 4.67521 7.44185C4.17931 6.84952 3.43569 6.50407 2.62736 6.50407C1.17864 6.50407 0 7.63123 0 9.01668C0 9.68956 0.276474 10.3213 0.767341 10.7905C0.474577 11.3914 0.326319 12.0164 0.326319 12.6524C0.326319 14.3788 1.40699 15.99 3.36941 17.1894C5.27965 18.357 7.81213 19 10.5 19C13.188 19 15.7203 18.357 17.6306 17.1894C19.593 15.99 20.6737 14.3788 20.6737 12.6524C20.6737 12.0164 20.5254 11.3915 20.2327 10.7905C20.7235 10.3212 21 9.68956 21 9.01668ZM1.15371 9.87793C0.987664 9.62021 0.900811 9.32602 0.900811 9.01668C0.900811 8.10625 1.67528 7.36554 2.62736 7.36554C3.03603 7.36554 3.41993 7.49842 3.72703 7.743C2.62939 8.33899 1.76536 9.05595 1.15371 9.87793ZM5.1076 11.3328C5.1076 10.3432 5.94948 9.53808 6.98429 9.53808C8.01909 9.53808 8.86098 10.3432 8.86098 11.3328C8.86098 12.3224 8.01909 13.1275 6.98429 13.1275C5.94948 13.1275 5.1076 12.3224 5.1076 11.3328ZM14.3498 15.4286C13.6183 16.1923 12.1432 16.6666 10.5 16.6666C8.85692 16.6666 7.38177 16.1923 6.65024 15.4286C6.51474 15.2872 6.44508 15.1038 6.45378 14.9123C6.46249 14.7207 6.54882 14.5438 6.69663 14.4143C6.83543 14.2927 7.01544 14.2258 7.20363 14.2258C7.4136 14.2258 7.6153 14.3107 7.75711 14.4586C8.19272 14.9133 9.32054 15.2308 10.5 15.2308C11.6795 15.2308 12.8074 14.9133 13.2429 14.4586C13.3847 14.3106 13.5864 14.2258 13.7964 14.2258C13.9847 14.2258 14.1647 14.2927 14.3035 14.4143C14.4514 14.5438 14.5376 14.7207 14.5463 14.9123C14.5551 15.1038 14.4853 15.2872 14.3498 15.4286ZM14.0157 13.1275C12.9809 13.1275 12.139 12.3224 12.139 11.3328C12.139 10.3432 12.9809 9.53808 14.0157 9.53808C15.0505 9.53808 15.8924 10.3432 15.8924 11.3328C15.8924 12.3224 15.0505 13.1275 14.0157 13.1275ZM19.8463 9.87793C19.2347 9.05595 18.3707 8.33907 17.273 7.743C17.5801 7.49835 17.964 7.36554 18.3726 7.36554C19.3247 7.36554 20.0992 8.10625 20.0992 9.01668C20.0992 9.32602 20.0123 9.62021 19.8463 9.87793Z" fill="#969696"/>
                            </svg>
                        </div>
                    </div>
                    <div class="footer-item copy" onclick="onCopyLink()">
                        Copy link
                        <div>
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.4615 7H8.53846C7.68879 7 7 7.68879 7 8.53846V15.4615C7 16.3112 7.68879 17 8.53846 17H15.4615C16.3112 17 17 16.3112 17 15.4615V8.53846C17 7.68879 16.3112 7 15.4615 7Z" stroke="#969696" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3.30769 11H2.53846C2.13044 11 1.73912 10.8379 1.4506 10.5494C1.16209 10.2609 1 9.86956 1 9.46154V2.53846C1 2.13044 1.16209 1.73912 1.4506 1.4506C1.73912 1.16209 2.13044 1 2.53846 1H9.46154C9.86956 1 10.2609 1.16209 10.5494 1.4506C10.8379 1.73912 11 2.13044 11 2.53846V3.30769" stroke="#969696" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="footer-item copy" onclick="copyText()">
                        Copy All text
                        <div>
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.4615 7H8.53846C7.68879 7 7 7.68879 7 8.53846V15.4615C7 16.3112 7.68879 17 8.53846 17H15.4615C16.3112 17 17 16.3112 17 15.4615V8.53846C17 7.68879 16.3112 7 15.4615 7Z" stroke="#969696" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3.30769 11H2.53846C2.13044 11 1.73912 10.8379 1.4506 10.5494C1.16209 10.2609 1 9.86956 1 9.46154V2.53846C1 2.13044 1.16209 1.73912 1.4506 1.4506C1.73912 1.16209 2.13044 1 2.53846 1H9.46154C9.86956 1 10.2609 1.16209 10.5494 1.4506C10.8379 1.73912 11 2.13044 11 2.53846V3.30769" stroke="#969696" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="status-message hide" onclick="window.app.hideStatusMes()"></div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            var rootApp = document.querySelector("#app");
            var container = rootApp.querySelector('#app > .container');
            var img = container.querySelector('.img-paste');
            var imgTexts = container.querySelector('.img-with-texts');
            var header = container.querySelector('.container-header');
            var upload = container.querySelector('.upload-wrapper');
            var imgFooter = container.querySelector('.img-with-text-footer');
            var dragging = container.querySelector('.dragging');
            var statusMes = container.querySelector('.status-message');

            function callREST(img) {
                return new Promise(function(resolve, reject) {
                    fetch('/upload/', { 
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(img),
                    }).then(response => {
                        response.json().then(json => {
                           resolve(json)
                        });
                    })
                })
            }

            var hideAndShowElm = {
                showLoader() {
                    this.hideLoader();
                    this.isLoading = true;

                    var imgWrap = container.querySelector('.content');

                    imgWrap.insertAdjacentElement('afterbegin', this.getLoaderElement());
                    
                    return this;
                },
                showStatusMes(element, status = 'success') {
                    statusMes.textContent = this.statusText[element][status];
                    statusMes.classList.remove('hide');
                    return this;
                },
                hideStatusMes() {
                    statusMes.textContent = '';
                    statusMes.classList.remove('hide');
                    return this;
                },
                hideStatusWithTimeout(t = 2500) {
                    var inst = this;
                    setTimeout(function() {
                        inst.hideStatusMes();
                    }, t)
                    return this;
                },
                hideLoader() {
                    this.isLoading = false;
                    var loader = container.querySelector('.loader');

                    if(loader) loader.remove();

                    return this;
                },
                showDragging() {
                    dragging.classList.remove('hide');
                    return this;
                },
                hideDragging() {
                    dragging.classList.add('hide');
                    return this;
                },
            };

            var layouts = {
                showImageLayout() {
                    img.classList.remove('hide');
                    imgTexts.classList.remove('hide');
                    imgFooter.classList.remove('hide');

                    container.querySelector('.content').style.alignItems = 'center';

                    return this;
                },
                hideImageLayout() {
                    img.classList.add('hide');
                    imgTexts.classList.add('hide');
                    imgFooter.classList.add('hide');

                    return this;
                },
                hideInitLayout() {
                    header.classList.add('hide');
                    upload.classList.add('hide');

                    return this;
                },
                showInitLayout() {
                    header.classList.remove('hide');
                    upload.classList.remove('hide');

                    container.querySelector('.content').style.alignItems = 'flex-start';

                    return this;
                },
                startUploadLayout(base64) {
                    this.hideInitLayout().setBase64(base64).setImgSrc().setScaleContainer().showLoader();
                    return this;
                },
                endUploadLayout(texts) {
                    app.setTexts(texts).insertText().hideLoader();
                    return this;
                },
            };

            var utils = {
                getOriginalSize(base64) {
                    return new Promise(function(resolve) {
                        var img = new Image();

                        img.onload = function(readerEvent) {
                            var origSize =  {
                                width: img.naturalWidth,
                                height: img.naturalHeight,
                            }

                            this.naturalSize = origSize;

                            resolve(origSize);
                        }

                        img.src = base64;
                    })
                },
                setImgToStorage() {
                    try {
                        localStorage.setItem('imgInf', JSON.stringify({
                            base64: this.base64,
                            texts: this.texts,
                        }));
                    } catch (e) {
                        console.log(e);
                    }
                    return this;
                },
                getImgFromStorage() {
                    try {
                        var base64 = JSON.parse(localStorage.getItem('imgInf'));
                    } catch (e) {
                        console.log(e);
                    }
                    return base64;
                },
                calcScale(size) {
                    var containerWidth = this.calcContainerWidth();

                    var scale = size.width / containerWidth;
                    this.scale = scale;

                    return scale;
                },
                calcContainerWidth() {
                    this.containerWidth = window.parseInt(window.getComputedStyle(container)['max-width']);
                    return this.containerWidth;
                },
                calcTextSizeParams() {
                    var maxH = 0;
                    var minH = Infinity;
                    var sum = 0;
                    
                    this.texts.forEach(function(text) {
                        if(text.height > maxH) maxH = text.height;
                        if(text.height < minH) minH = text.height;
                        sum += text.height;
                    });

                    sum -= maxH + minH;
                    var averageH = sum / this.texts.length - 2;

                    var popularH = this.texts.sort((a,b) =>
                        this.texts.filter(v => v.height=== a.height).length
                        - this.texts.filter(v => v.height === b.height).length
                    ).pop().height;

                    var rateMax = maxH / popularH;
                    var rateMin = popularH / minH;

                    return  { 
                        maxH, 
                        averageH,
                        popularH,
                        rateMax,
                        rateMin,
                        minH,
                    }
                },
                getImgScale(base64) {
                    var inst = this;

                    if(this.naturalSize) return Promise.resolve(this.calcScale(this.naturalSize));

                    return this.getOriginalSize(base64)
                        .then(function(sizeOrig) {
                            return inst.calcScale(sizeOrig);
                        });
                },
            };

            var app = {
                root: rootApp,
                imgData: null,
                texts: null,
                base64: null,
                scale: null,
                naturalSize: null,
                containerWidth: null,
                isLoading: false,
                anomalyRate: 10,
                statusText: {
                    linkCopy: {
                        success: 'Your copy link to clipboard',
                    },
                    textCopy: {
                        success: 'Your copy text to clipboard',
                    }
                },
                ...hideAndShowElm,
                ...layouts,
                ...utils,
                setTexts(texts) {
                    this.texts = texts;

                    return this;
                },
                setBase64(base64) {
                    this.base64 = base64;

                    return this;
                },
                setImgSrc() {
                    this.imgData = this.base64.split(',')[1];
                    
                    var inst = this;

                    img.onload = function() {
                        inst.showImageLayout();
                    }

                    img.src = this.base64;

                    return this;
                },
                getLoaderElement() {
                    const div = document.createElement('div');

                    div.classList.add('lds-ring', 'loader', 'loader-texts');
                    div.innerHTML = '<div></div><div></div><div></div><div></div>';
                    
                    return div;
                },
                getTexts() {
                    return imgTexts.textContent.trim();
                },
                createTextHTML({text, top, left, width, height}) {
                    return `<div class="text" style="position: absolute;top:${top}px; left:${left}px; font-size:${height}px;width:${width}px; height:${height}px;backdrop-filter: blur(3px);">${text}&nbsp;</div>`;
                },
                setScaleContainer() {
                    this.getImgScale(this.base64)
                        .then(function(scale) {
                            if(scale < 1) return;
                            imgTexts.style.transform = `scale(${(1 / scale).toFixed(6)})`
                        });

                    return this;
                },
                insertText() {
                    if(!this.texts.length) return this;

                    if(this.texts.length === 1 && !this.texts[0].text.trim()) return this;
                    
                    var inst = this;

                    this.setImgToStorage();
                    var textParams = this.calcTextSizeParams();

                    this.texts.forEach(function(text) {
                        if(textParams.rateMax >= inst.anomalyRate && textParams.maxH === text.height) text.height = textParams.popularH;
                        if(textParams.rateMin >= inst.anomalyRate && textParams.minH === text.height) text.height = textParams.popularH;
                    
                        const html = inst.createTextHTML(text);
                        imgTexts.insertAdjacentHTML('beforeend', html);
                    });

                    return this;
                },
                reset() {
                    var inst = this;

                    this.hideLoader();

                    this.setImgToStorage(null);

                    Object.keys(inst).forEach(function(key) {
                        if(typeof inst[key] !== 'function' && key !== 'root') {
                            inst[key] = null;
                        }
                    });

                    imgTexts.innerHTML = '';
                    img.src = '';

                    this.hideImageLayout().hideLoader().setImgToStorage('').showInitLayout();
                },
            };

            window.onResetClick = function() {
                app.reset();
            };

            window.onCopyLink = function() {
                app.showStatusMes('linkCopy').hideStatusWithTimeout();;

                navigator.clipboard.writeText(document.URL);
            };

            window.app = app;

            window.copyText = function() {
                app.showStatusMes('textCopy').hideStatusWithTimeout();

                navigator.clipboard.writeText(app.getTexts());
            };

            var imgStorage = app.getImgFromStorage();

            if(imgStorage && imgStorage.base64 && imgStorage.texts) {
                app.startUploadLayout(imgStorage.base64)
                    .endUploadLayout(imgStorage.texts);          
            } else {
                app.showInitLayout();
            }

            window.addEventListener('dragenter', function(e) {
                e.preventDefault();

                app.showDragging();
            }, false);

            window.addEventListener('dragleave', function(e) {
                e.preventDefault();
                if (e.fromElement === null) {
                    app.hideDragging();
                }
            }, false);

            window.addEventListener("dragover",function(e) {
                e.preventDefault();
            }, false);

            window.addEventListener("drop", function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                app.hideDragging();

                var files = Array.from(e.dataTransfer.files);
              
                var reader = new FileReader();

                reader.onload = (ev) => {
                    sendImageToServer(ev.target.result);
                }

                reader.readAsDataURL(files[0]);
       
            }, false);

            function sendImageToServer(base64) {
                app.startUploadLayout(base64);
                try {
                    callREST({base64: app.imgData}).then(function(resp) {
                        app.endUploadLayout(resp.texts);
                    });
                } catch (e) {
                    console.log(e);
                }
            }

            document.onpaste = function(e) {
                var { items } = event.clipboardData || event.originalEvent.clipboardData;
                
                Array.from(items).forEach(function(item) {
                    if (item.kind === 'file') {
                        var blob = item.getAsFile();
                        var reader = new FileReader();

                        reader.onload = (readerEvent) => {
                            sendImageToServer(readerEvent.target.result);
                        };
                        
                        reader.readAsDataURL(blob);
                    }
                });
            }

            window.onresize = function(e) {
                app.setScaleContainer();
            }
        })
    </script>
</body>
</html>